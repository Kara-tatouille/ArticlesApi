# ArticlesApi

## Sujet

D√©velopper une petite application web qui permet de g√©rer des articles √† partir d‚Äôune API.
Il faut s‚Äôimaginer que c‚Äôest le d√©but d‚Äôune grosse application qui sera amen√©e √† √©voluer.
Chaque √©l√©ment doit √™tre pens√© pour pouvoir √©voluer, √™tre maintenu facilement et √™tre performant.

## Setup

Pour faire fonctionner l'application, suivez les √©tapes suivantes :

**Installation des d√©pendances de Composer**

Assurez-vous que vous avez install√© [Composer](https://getcomposer.org/download/).
Puis ex√©cutez :

```
composer install
```

**Configuration de la base de donn√©es**

Tout d'abord, assurez-vous que vous avez [Docker install√©](https://docs.docker.com/get-docker/)
et qu'il fonctionne. Pour d√©marrer le conteneur, ex√©cutez :

```
docker-compose up -d
```

Ensuite, il faut construire la base de donn√©es, ex√©cuter les migrations et charger les fixtures avec :

```
# "symfony console" is equivalent to "bin/console"
# but its aware of your database container
symfony console doctrine:database:create
symfony console doctrine:migrations:migrate
symfony console doctrine:fixtures:load
```

Le binaire `symfony` peut √™tre t√©l√©charg√© √† partir de https://symfony.com/download.

**G√©n√©ration des cl√©s SSL**

```
symfony console lexik:jwt:generate-keypair
```

`openssl` est requis pour g√©n√©rer ces cl√©s.
Vous pouvez l'installer avec `choco install openssl` sur windows
ou bien `brew install openssl` sur mac

Les cl√©s seront sauvegard√©es dans `config/jwt/private.pem` et `config/jwt/public.pem`

**D√©marrer le serveur web Symfony**.

Vous pouvez utiliser Nginx ou Apache, mais le serveur web local de Symfony
est ma solution recommand√©e.

Pour installer le serveur web local de Symfony, suivez les instructions suivantes
les instructions "T√©l√©charger le client Symfony" trouv√©es
ici : https://symfony.com/download - vous n'avez besoin de faire cela qu'une seule fois
une seule fois sur votre syst√®me.

Ensuite, pour d√©marrer le serveur web, ouvrez un terminal, allez dans le projet
et ex√©cutez :

```
symfony serve
```

(Si c'est la premi√®re fois que vous utilisez cette commande, vous pouvez voir une
erreur indiquant que vous devez d'abord ex√©cuter `symfony server:ca:install`).

Maintenant acc√©dez au site √† `https://localhost:8000`

## API et Documentation Swagger

**documentation Swagger**

Une documentation Swagger est g√©n√©r√©e automatiquement par le bundle API-Platform.
Cette documentation est disponible √† l'adresse https://localhost:8000/api

**json+ld**

L'API utilise par d√©faut le format `json+ld`, un format analogue au format `json`
 lui ajoutant des m√©ta-donn√©es utiles pour l'exploration des endpoints.
Le format `json` classique est √©galement disponible lorsqu'il est demand√©
par le header `accept` ou lorsqu'il est sp√©cifi√© dans l'url 
`https://127.0.0.1:8000/api/articles.json?page=1`

**Donn√©es de base**

Lors de la cr√©ation de la base de donn√©e, 2 utilisateurs, les status et un 
article de test sont g√©n√©r√©s.

## Authentification

Tous les endpoints requiert une connexion pour y acc√©der.
Pour r√©cup√©rer un token de connexion, une requ√™te POST √† l'URI `/authentication_token`
est n√©cessaire. Plus d'informations sur cette requ√™te sont disponibles dans
la documentation swagger accessible √† l'URI `/api`

2 utilisateurs sont g√©n√©r√©s √† la cr√©ation de la base de donn√©e,
il n'est pas possible de cr√©er ou de modifier un utilisateur via l'API.
Voici leurs informations de connexion √† utiliser pour g√©n√©rer un token JWT :
```json
{
  "email": "jhondoe@example.com",
  "password": "1234"
}
```
```json
{
  "email": "test@example.com",
  "password": "foo"
}
```

Une fois ce token r√©cup√©r√©, il est n√©cessaire de l'ajouter au header "Authorization"

Exemple avec curl :
```bash
curl -X 'GET' \
  'https://127.0.0.1:8000/api/articles?page=1' \
  -H 'accept: application/ld+json' \
  -H 'Authorization: BEARER eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJpYXQiOjE2NTU0NTYwNzcsImV4cCI6MTY1NTQ1OTY3Nywicm9sZXMiOlsiUk9MRV9VU0VSIl0sInVzZXJuYW1lIjoidGVzdEBleGFtcGxlLmNvbSJ9.O0K5iQ6b9i6fC7INTVaP6rahJH90kTCrFXBreI1EQM_15FwcWR38JE3dc2-kdiG47N7Ix71YGQ7cXI5UW7n2PP_rtoljW1rUL3-IUeem6Ghn3_dCngup7lY0CoZD0Vy5HoHangMC7tSWTXpStOXLI2_jxNTiMG2z7MhnpHqpq0QlojJfcl2mpv7CRMtj8UZZFq-8oYG9HfL5EzPBPAqk7h1BooWRTJKAzjp24HmxUjaurYIgflXTU9bLZmZq0VIGN28NN4X7hX4099KSlYVGfvol-svO7zvO9MS8BnDFS8IGRmBFpvHNC-QVpK611TdV5r0sA1yyMvPCcufiCMB_wA'
```

Depuis la documentation swagger, un bouton "Authorize üîí" est pr√©sent pour
ajouter de mani√®re automatique ce token √† toutes les requ√™tes.

![](https://i.imgur.com/gPx4LfR.png)
